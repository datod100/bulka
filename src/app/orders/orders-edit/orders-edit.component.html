<h3>{{title}} order</h3>

<form #editOrder="ngForm" class="default-width-form center-block">
  <div class="form-group">
    <div class="input-group mb-2">
      <div class="input-group-prepend">
        <div class="input-group-text fixed-width">
          Client
        </div>
      </div>
      <p-autoComplete [(ngModel)]="order.client" name="client" [suggestions]="filteredClients" (completeMethod)="search($event)"
        field="name" [dropdown]="true" required></p-autoComplete>
    </div>

    <div class="input-group mb-2">
      <div class="input-group-prepend">
        <div class="input-group-text fixed-width">
          Status
        </div>
      </div>
      <div ngbDropdown class="col p-0">
        <button class="btn w-50" id="status" name="status" [ngStyle]="{'background-color':order.status.color}" ngbDropdownToggle>{{order.status.name}}</button>
        <div ngbDropdownMenu class="dropdown-menu" aria-labelledby="status">
          <button class="dropdown-item" *ngFor="let status of statuses" (click)="changeStatus(status.status_id)" [ngStyle]="{'background-color':status.color}">{{status.name}}</button>
        </div>
      </div>
    </div>
    <div class="w-100">
      <div class="input-group mb-2 float-left mobile2col">
        <div class="input-group-prepend">
          <div class="input-group-text fixed-width">
            Confirm. #
          </div>
        </div>
        <input type="text" class="form-control" [(ngModel)]="order.confirmation_number" id="confirmation_number" name="confirmation_number"
          placeholder="Confirmation number" required>
      </div>

      <div class="input-group mb-2 float-left mobile2col p-0">
        <div class="input-group-prepend">
          <div class="input-group-text desktop-fixed-width">
            <span class="desktophide">Confirm.</span> Date
          </div>
        </div>
        <input type="text" class="form-control" [displayMonths]="1" [(ngModel)]="order.confirmation_date" ngbDatepicker id="confirmation_date"
          name="confirmation_date" required #d="ngbDatepicker" [firstDayOfWeek]="7">
        <div class="input-group-append">
          <button class="btn btn-outline-secondary" (click)="d.toggle()" type="button">
            <i class="fa fa-calendar"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="input-group mb-2">
      <div class="input-group-prepend">
        <div class="input-group-text fixed-width">
          Supply Date
        </div>
      </div>
      <input type="text" class="form-control" [displayMonths]="1" [(ngModel)]="order.supply_date" ngbDatepicker id="supply_date"
        name="supply_date" #d2="ngbDatepicker" [firstDayOfWeek]="7">
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" (click)="d2.toggle()" type="button">
          <i class="fa fa-calendar"></i>
        </button>
      </div>
    </div>

    <div class="input-group mb-2">
      <div class="input-group-prepend">
        <div class="input-group-text fixed-width">
          Proform #
        </div>
      </div>
      <input type="text" class="form-control" [(ngModel)]="order.proform_number" id="proform_number" name="proform_number" placeholder="Proform number">
    </div>
  </div>
  <div class="d-flex w-100 pb-3">
    <button type="submit" class="btn btn-primary col mr-2" (click)="save(true)" [disabled]="editOrder.invalid">
      <i class="fa fa-save"></i> Save <span class="mobileshow">order</span></button>
    <button type="button" class="btn btn-secondary col mr-2" (click)="addItem()" [disabled]="editOrder.invalid">
        <i class="fa fa-plus-circle"></i> <span class="mobileshow">Add</span> Item</button>
    <button type="button" class="btn btn-secondary col mr-2" [routerLink]="['/orders']">
          <i class="fa fa-close"></i> Close</button>
    <span class="col mobileshow"></span>
    <button type="button" class="btn btn-danger col" (click)="delete(content)" *ngIf="order.order_id">
      <i class="fa fa-trash"></i> <span class="mobileshow">Delete</span></button>
  </div>
</form>


<ul class="list-group default-width-form center-block">
  <li [ngStyle]="{'cursor': 'default'}" class="list-group-item active h5 p-2">Items</li>
  <li class="list-group-item list-group-item-action flex-column align-items-start p-2 pointer_hand" *ngFor="let item of order.items"
    (click)="selectItem(item)">
    <div class="d-flex w-100">
      <span class="mb-1 col-4 p-0 pt-1">{{item.collection_name}}</span>
      <span class="col p-0 pt-1 font-weight-bold">{{item.article}}</span>
      <span class="pr-2 pt-1">x{{item.quantity}} {{item.product_type}}</span>
      <span class="pr-2 pt-1">({{item.price * item.quantity}} &#8362;)</span>

    </div>
  </li>
</ul>

<app-orders-edit-item [item]="selectedItem" (OnSave)="OnItemSave($event)" (OnDelete)="OnItemDelete()" id="itemForm"></app-orders-edit-item>

<ng-template #content let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h5 class="modal-title">Delete order</h5>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>Are you sure?</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="c('delete')"><i class="fa fa-trash"></i> Delete</button>    
    <button type="button" class="btn btn-secondary" (click)="c()"><i class="fa fa-times"></i> Cancel</button>
  </div>
</ng-template>